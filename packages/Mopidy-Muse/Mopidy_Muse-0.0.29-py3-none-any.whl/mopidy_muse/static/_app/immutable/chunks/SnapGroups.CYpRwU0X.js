import{s as Ne,c as je,r as z,d as Oe,e as ce}from"./scheduler.-rnGJo_9.js";import{S as ye,i as Ge,v as fe,g as J,n as E,k as R,l as y,m as q,d as v,e as j,s as B,c as O,a as T,f as P,q as g,h as N,r as D,E as $e,t as H,b as M,y as W,A as Ce,j as re,p as De,u as te,w as X,x as Y,z as Z,B as K}from"./index.BZ2zs19M.js";import{X as I,Y as ae,G as Te,H as Je,I as Ve,e as ne,F as Q,Z as Ie,_ as Le,$ as Ue,a0 as Ae,a1 as Be}from"./mopidyTools.C8WXbiuN.js";let G,A,oe,ie,ue;I.subscribe(t=>{A=t});ae.subscribe(t=>{G=t});Te.subscribe(t=>{oe=t});Je.subscribe(t=>{ie=t});Ve.subscribe(t=>{ue=t});function Qe(t){return new Promise(function(e,l){if(G&&!t)ae.set(G),e("Connected");else{const n=oe||window.location.hostname,s=ie||window.location.port,u=ue||(window.location.protocol==="https:"?"true":"false");G=new WebSocket(`ws${u==="true"?"s":""}://${n}:${s}/jsonrpc`),G.onerror=i=>{console.log("[Snapcast]: error:",i),l(new Error("error connecting to snapcast"))},G.onopen=()=>{console.log("[Snapcast]: Connected");let i={jsonrpc:"2.0",id:8,method:"Server.GetStatus"};G.send(JSON.stringify(i)),ae.set(G),e("Connected")},G.onmessage=i=>{Pe(i)}}})}const de=t=>{I.set(t.map(e=>({id:e.id,name:e.name,muted:e.muted,clients:e.clients.map(l=>({id:l.id,host:l.host.name,name:l.config.name,volume:l.config.volume.percent,connected:l.connected,muted:l.config.volume.muted}))})))};function Pe(t){const e=JSON.parse(t.data);if(console.log("[Snapcast]: ",e),e.result&&e.result.server&&e.result.server.groups){const l=e.result.server.groups;de(l)}if(e&&e.method){if(e.method==="Client.OnDisconnect"){const l=e.params.client.id;I.set(A.map(n=>(n.clients.forEach(s=>{s.id===l&&(s.connected=!1)}),n)))}else if(e.method==="Client.OnConnect"){const l=e.params.client.id;I.set(A.map(n=>(n.clients.forEach(s=>{s.id===l&&(s.connected=!0)}),n)))}else if(e.method==="Client.OnNameChanged"){const l=e.params.id;I.set(A.map(n=>(n.clients.forEach(s=>{s.id===l&&(s.name=e.params.name)}),n)))}else if(e.method==="GrClient.OnNameChanged"){const l=e.params.id;I.set(A.map(n=>(n.id===l&&(n.client.name=e.params.name),n)))}else if(e.method==="Client.OnVolumeChanged"){const l=e.params.id;I.set(A.map(n=>(n.clients.forEach(s=>{s.id===l&&(s.volume=e.params.volume.percent)}),n)))}else if(e.method==="Server.OnUpdate"){const l=e.params.server.groups;de(l)}}}function xe(t,e){console.log(`[Snapcast]: ${e?"Unmute":"Mute"} client ${t}`);let l={id:8,jsonrpc:"2.0",method:"Client.SetVolume",params:{id:t,volume:{muted:!1,percent:e?10:0}}};G.send(JSON.stringify(l)),I.set(A.map(n=>(n.clients.forEach(s=>{s.id==t&&(s.volume=e?10:0,s.muted=!e)}),n)))}function et(t,e){console.log(`[Snapcast]: ${e?"Unmute":"Mute"} group ${t}`);let l={id:8,jsonrpc:"2.0",method:"Group.SetMute",params:{id:t,mute:!e}};G.send(JSON.stringify(l)),I.set(A.map(n=>(n.muted=!e,n.id===t&&n.clients.forEach(s=>s.muted=!e),n)))}function tt(t,e){console.log(`Client ${t} - vol ${e}`);let l={id:8,jsonrpc:"2.0",method:"Client.SetVolume",params:{id:t,volume:{muted:!1,percent:e}}};G.send(JSON.stringify(l))}const Fe=(t,e)=>{const l={id:8,jsonrpc:"2.0",method:"Group.SetName",params:{id:t,name:e}};G.send(JSON.stringify(l))},He=(t,e)=>{const l={id:8,jsonrpc:"2.0",method:"Client.SetName",params:{id:t,name:e}};G.send(JSON.stringify(l))},me=(t,e)=>{const l={id:8,jsonrpc:"2.0",method:"Group.SetClients",params:{clients:e,id:t}};G.send(JSON.stringify(l))},ee=t=>{const e={id:8,jsonrpc:"2.0",method:"Server.DeleteClient",params:{id:t}};G.send(JSON.stringify(e))};function pe(t,e,l){const n=t.slice();return n[21]=e[l],n[22]=e,n[23]=l,n}function he(t,e,l){const n=t.slice();return n[24]=e[l],n[25]=e,n[26]=l,n}function _e(t){let e,l,n,s,u,i,d,h,k,C,w,_,$=ne(t[6]),f=[];for(let r=0;r<$.length;r+=1)f[r]=ke(pe(t,$,r));const L=r=>y(f[r],1,1,()=>{f[r]=null});let S=t[5]&&Se(t);const V=[We,qe],o=[];function F(r,a){return r[4]===!0?0:1}return h=F(t),k=o[h]=V[h](t),{c(){e=j("div"),l=j("div"),n=j("aside");for(let r=0;r<f.length;r+=1)f[r].c();s=B(),S&&S.c(),u=B(),i=j("div"),d=j("a"),k.c(),this.h()},l(r){e=O(r,"DIV",{class:!0});var a=T(e);l=O(a,"DIV",{class:!0});var c=T(l);n=O(c,"ASIDE",{class:!0});var p=T(n);for(let U=0;U<f.length;U+=1)f[U].l(p);s=P(p),S&&S.l(p),p.forEach(v),c.forEach(v),u=P(a),i=O(a,"DIV",{class:!0});var m=T(i);d=O(m,"A",{class:!0,href:!0});var b=T(d);k.l(b),b.forEach(v),m.forEach(v),a.forEach(v),this.h()},h(){g(n,"class","menu svelte-ojelhk"),g(l,"class","column is-12"),g(d,"class","button"),g(d,"href",null),g(i,"class","column is-12"),g(e,"class","columns is-multiline")},m(r,a){J(r,e,a),N(e,l),N(l,n);for(let c=0;c<f.length;c+=1)f[c]&&f[c].m(n,null);N(n,s),S&&S.m(n,null),N(e,u),N(e,i),N(i,d),o[h].m(d,null),C=!0,w||(_=D(d,"click",t[20]),w=!0)},p(r,a){if(a&95){$=ne(r[6]);let p;for(p=0;p<$.length;p+=1){const m=pe(r,$,p);f[p]?(f[p].p(m,a),E(f[p],1)):(f[p]=ke(m),f[p].c(),E(f[p],1),f[p].m(n,s))}for(R(),p=$.length;p<f.length;p+=1)L(p);q()}r[5]?S?S.p(r,a):(S=Se(r),S.c(),S.m(n,null)):S&&(S.d(1),S=null);let c=h;h=F(r),h!==c&&(R(),y(o[c],1,1,()=>{o[c]=null}),q(),k=o[h],k||(k=o[h]=V[h](r),k.c()),E(k,1),k.m(d,null))},i(r){if(!C){for(let a=0;a<$.length;a+=1)E(f[a]);E(k),C=!0}},o(r){f=f.filter(Boolean);for(let a=0;a<f.length;a+=1)y(f[a]);y(k),C=!1},d(r){r&&v(e),$e(f,r),S&&S.d(),o[h].d(),w=!1,_()}}}function ge(t){let e,l,n;function s(){t[7].call(e,t[22],t[23])}function u(){return t[8](t[21])}return{c(){e=j("input"),this.h()},l(i){e=O(i,"INPUT",{class:!0,type:!0,placeholder:!0}),this.h()},h(){g(e,"class","input svelte-ojelhk"),g(e,"type","text"),g(e,"placeholder","Group name")},m(i,d){J(i,e,d),te(e,t[21].name),l||(n=[D(e,"input",s),D(e,"input",u)],l=!0)},p(i,d){t=i,d&64&&e.value!==t[21].name&&te(e,t[21].name)},d(i){i&&v(e),l=!1,z(n)}}}function Me(t){let e,l;return e=new Q({props:{icon:Ae,class:"icon is-small"}}),{c(){X(e.$$.fragment)},l(n){Y(e.$$.fragment,n)},m(n,s){Z(e,n,s),l=!0},i(n){l||(E(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){K(e,n)}}}function Re(t){let e,l;return e=new Q({props:{icon:Be,class:"icon is-small"}}),{c(){X(e.$$.fragment)},l(n){Y(e.$$.fragment,n)},m(n,s){Z(e,n,s),l=!0},i(n){l||(E(e.$$.fragment,n),l=!0)},o(n){y(e.$$.fragment,n),l=!1},d(n){K(e,n)}}}function ve(t){let e,l,n,s,u,i,d,h,k;function C(){t[12].call(l,t[26],t[22],t[23])}function w(){return t[13](t[21],t[26])}return i=new Q({props:{icon:Ue,class:"icon"}}),{c(){e=j("div"),l=j("input"),n=B(),s=j("div"),u=j("button"),X(i.$$.fragment),this.h()},l(_){e=O(_,"DIV",{class:!0});var $=T(e);l=O($,"INPUT",{class:!0,type:!0,placeholder:!0}),$.forEach(v),n=P(_),s=O(_,"DIV",{class:!0,role:!0,tabindex:!0});var f=T(s);u=O(f,"BUTTON",{class:!0});var L=T(u);Y(i.$$.fragment,L),L.forEach(v),f.forEach(v),this.h()},h(){g(l,"class","input svelte-ojelhk"),g(l,"type","text"),g(l,"placeholder","Client name"),g(e,"class","column"),g(u,"class","button"),g(s,"class","column is-narrow"),g(s,"role","button"),g(s,"tabindex","0")},m(_,$){J(_,e,$),N(e,l),te(l,t[21].clients[t[26]].name),J(_,n,$),J(_,s,$),N(s,u),Z(i,u,null),d=!0,h||(k=[D(l,"input",C),D(l,"input",w),D(s,"click",function(){ce(ee(t[24].id))&&ee(t[24].id).apply(this,arguments)}),D(s,"keypress",function(){ce(ee(t[24].id))&&ee(t[24].id).apply(this,arguments)})],h=!0)},p(_,$){t=_,$&64&&l.value!==t[21].clients[t[26]].name&&te(l,t[21].clients[t[26]].name)},i(_){d||(E(i.$$.fragment,_),d=!0)},o(_){y(i.$$.fragment,_),d=!1},d(_){_&&(v(e),v(n),v(s)),K(i),h=!1,z(k)}}}function be(t){let e,l,n,s,u,i,d,h=(t[24].name?t[24].name:t[24].host)+"",k,C,w,_,$,f;const L=[Re,Me],S=[];function V(a,c){return a[24].connected?0:1}u=V(t),i=S[u]=L[u](t);let o=t[4]===!0&&ve(t);function F(...a){return t[14](t[23],t[26],...a)}function r(){return t[15](t[23],t[26])}return{c(){e=j("li"),l=j("div"),n=j("div"),s=j("a"),i.c(),d=B(),k=H(h),C=B(),o&&o.c(),this.h()},l(a){e=O(a,"LI",{draggable:!0,id:!0});var c=T(e);l=O(c,"DIV",{class:!0});var p=T(l);n=O(p,"DIV",{class:!0});var m=T(n);s=O(m,"A",{href:!0,class:!0});var b=T(s);i.l(b),d=P(b),k=M(b,h),b.forEach(v),m.forEach(v),C=P(p),o&&o.l(p),p.forEach(v),c.forEach(v),this.h()},h(){g(s,"href",null),g(s,"class","svelte-ojelhk"),g(n,"class","column"),g(l,"class","columns is-mobile is-gapless"),g(e,"draggable",!0),g(e,"id",w=t[24].id),W(e,"hover",t[3].group===t[23]&&t[3].client===t[26])},m(a,c){J(a,e,c),N(e,l),N(l,n),N(n,s),S[u].m(s,null),N(s,d),N(s,k),N(l,C),o&&o.m(l,null),_=!0,$||(f=[D(e,"dragstart",F),D(e,"mouseenter",r),D(e,"mouseleave",t[16])],$=!0)},p(a,c){t=a;let p=u;u=V(t),u!==p&&(R(),y(S[p],1,1,()=>{S[p]=null}),q(),i=S[u],i||(i=S[u]=L[u](t),i.c()),E(i,1),i.m(s,d)),(!_||c&64)&&h!==(h=(t[24].name?t[24].name:t[24].host)+"")&&re(k,h),t[4]===!0?o?(o.p(t,c),c&16&&E(o,1)):(o=ve(t),o.c(),E(o,1),o.m(l,null)):o&&(R(),y(o,1,1,()=>{o=null}),q()),(!_||c&64&&w!==(w=t[24].id))&&g(e,"id",w),(!_||c&8)&&W(e,"hover",t[3].group===t[23]&&t[3].client===t[26])},i(a){_||(E(i),E(o),_=!0)},o(a){y(i),y(o),_=!1},d(a){a&&v(e),S[u].d(),o&&o.d(),$=!1,z(f)}}}function ke(t){let e,l,n,s=t[21].name?`${t[21].name} - `:"",u,i=t[21].id+"",d,h,k,C,w,_,$,f=t[4]===!0&&ge(t);function L(...r){return t[9](t[23],...r)}function S(){return t[10](t[21])}let V=ne(t[21].clients),o=[];for(let r=0;r<V.length;r+=1)o[r]=be(he(t,V,r));const F=r=>y(o[r],1,1,()=>{o[r]=null});return{c(){e=j("div"),l=j("b"),n=H("Group "),u=H(s),d=H(i),h=B(),f&&f.c(),k=B(),C=j("ul");for(let r=0;r<o.length;r+=1)o[r].c();this.h()},l(r){e=O(r,"DIV",{class:!0,role:!0,tabindex:!0,ondragover:!0});var a=T(e);l=O(a,"B",{class:!0});var c=T(l);n=M(c,"Group "),u=M(c,s),d=M(c,i),c.forEach(v),h=P(a),f&&f.l(a),a.forEach(v),k=P(r),C=O(r,"UL",{class:!0});var p=T(C);for(let m=0;m<o.length;m+=1)o[m].l(p);p.forEach(v),this.h()},h(){g(l,"class","svelte-ojelhk"),g(e,"class","menu-label svelte-ojelhk"),g(e,"role","button"),g(e,"tabindex","0"),g(e,"ondragover","return false"),W(e,"hovering",t[2]===t[21].name),g(C,"class","menu-list svelte-ojelhk")},m(r,a){J(r,e,a),N(e,l),N(l,n),N(l,u),N(l,d),N(e,h),f&&f.m(e,null),J(r,k,a),J(r,C,a);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(C,null);w=!0,_||($=[D(e,"drop",Ce(L)),D(e,"dragenter",S),D(e,"dragleave",t[11])],_=!0)},p(r,a){if(t=r,(!w||a&64)&&s!==(s=t[21].name?`${t[21].name} - `:"")&&re(u,s),(!w||a&64)&&i!==(i=t[21].id+"")&&re(d,i),t[4]===!0?f?f.p(t,a):(f=ge(t),f.c(),f.m(e,null)):f&&(f.d(1),f=null),(!w||a&68)&&W(e,"hovering",t[2]===t[21].name),a&90){V=ne(t[21].clients);let c;for(c=0;c<V.length;c+=1){const p=he(t,V,c);o[c]?(o[c].p(p,a),E(o[c],1)):(o[c]=be(p),o[c].c(),E(o[c],1),o[c].m(C,null))}for(R(),c=V.length;c<o.length;c+=1)F(c);q()}},i(r){if(!w){for(let a=0;a<V.length;a+=1)E(o[a]);w=!0}},o(r){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)y(o[a]);w=!1},d(r){r&&(v(e),v(k),v(C)),f&&f.d(),$e(o,r),_=!1,z($)}}}function Se(t){let e,l,n,s="New group",u,i;return{c(){e=j("br"),l=B(),n=j("button"),n.textContent=s,this.h()},l(d){e=O(d,"BR",{}),l=P(d),n=O(d,"BUTTON",{class:!0,ondragover:!0,"data-svelte-h":!0}),De(n)!=="svelte-7t49dx"&&(n.textContent=s),this.h()},h(){g(n,"class","button is-fullwidth svelte-ojelhk"),g(n,"ondragover","return false"),W(n,"hovering",t[2]===t[6].length)},m(d,h){J(d,e,h),J(d,l,h),J(d,n,h),u||(i=[D(n,"drop",Ce(t[17])),D(n,"dragenter",t[18]),D(n,"dragleave",t[19])],u=!0)},p(d,h){h&68&&W(n,"hovering",d[2]===d[6].length)},d(d){d&&(v(e),v(l),v(n)),u=!1,z(i)}}}function qe(t){let e,l,n;return e=new Q({props:{icon:Ie,class:"icon"}}),{c(){X(e.$$.fragment),l=H("   Edit clients name")},l(s){Y(e.$$.fragment,s),l=M(s,"   Edit clients name")},m(s,u){Z(e,s,u),J(s,l,u),n=!0},i(s){n||(E(e.$$.fragment,s),n=!0)},o(s){y(e.$$.fragment,s),n=!1},d(s){s&&v(l),K(e,s)}}}function We(t){let e,l,n;return e=new Q({props:{icon:Le,class:"icon"}}),{c(){X(e.$$.fragment),l=H("   Finish edition")},l(s){Y(e.$$.fragment,s),l=M(s,"   Finish edition")},m(s,u){Z(e,s,u),J(s,l,u),n=!0},i(s){n||(E(e.$$.fragment,s),n=!0)},o(s){y(e.$$.fragment,s),n=!1},d(s){s&&v(l),K(e,s)}}}function ze(t){let e,l,n=t[6].length>0&&_e(t);return{c(){n&&n.c(),e=fe()},l(s){n&&n.l(s),e=fe()},m(s,u){n&&n.m(s,u),J(s,e,u),l=!0},p(s,[u]){s[6].length>0?n?(n.p(s,u),u&64&&E(n,1)):(n=_e(s),n.c(),E(n,1),n.m(e.parentNode,e)):n&&(R(),y(n,1,1,()=>{n=null}),q())},i(s){l||(E(n),l=!0)},o(s){y(n),l=!1},d(s){s&&v(e),n&&n.d(s)}}}function Xe(t,e,l){let n;je(t,I,m=>l(6,n=m));let s=!1,u={},i,d;function h(m,b){m.dataTransfer.dropEffect="move";let U=m.dataTransfer.getData("text/plain"),x=JSON.parse(U),Ee=x.item,le=x.group;const we=n[le].clients.splice(Ee,1)[0];b?(Oe(I,n[b].clients=[...n[b].clients,we],n),me(n[b].id,n[b].clients.map(se=>se.id))):me(n[le].id,n[le].clients.map(se=>se.id)),l(2,s=null),l(5,d=!1)}function k(m,b,U){l(5,d=!0),m.dataTransfer.effectAllowed="move",m.dataTransfer.dropEffect="move";let x={group:b,item:U,id:m.target.getAttribute("id")};m.dataTransfer.setData("text/plain",JSON.stringify(x))}function C(m,b){m[b].name=this.value,I.set(n)}const w=m=>Fe(m.id,m.name),_=(m,b)=>h(b,m),$=m=>l(2,s=m.name),f=()=>l(2,s=null);function L(m,b,U){b[U].clients[m].name=this.value,I.set(n)}return[h,k,s,u,i,d,n,C,w,_,$,f,L,(m,b)=>He(m.clients[b].id,m.clients[b].name),(m,b,U)=>k(U,m,b),(m,b)=>l(3,u={group:m,client:b}),()=>l(3,u={}),m=>h(m,null),()=>l(2,s=n.length),()=>l(2,s=null),()=>l(4,i=!i)]}class nt extends ye{constructor(e){super(),Ge(this,e,Xe,ze,Ne,{drop:0,dragstart:1})}get drop(){return this.$$.ctx[0]}get dragstart(){return this.$$.ctx[1]}}export{nt as S,tt as a,et as b,Qe as c,xe as m};
