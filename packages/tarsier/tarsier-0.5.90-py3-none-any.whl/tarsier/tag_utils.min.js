"use strict";const tarsierId="__tarsier_id",tarsierSelector=`#${tarsierId}`,elIsClean=t=>{const i=t.getBoundingClientRect(),o=window.getComputedStyle(t),n=o.visibility==="hidden"||o.display==="none"||t.hidden||t.disabled,r=o.opacity==="0",e=i.width===0||i.height===0,s=t.tagName==="SCRIPT"||t.tagName==="STYLE";return!n&&!r&&!e&&!s},inputs=["a","button","textarea","select","details","label"],isInteractable=t=>inputs.includes(t.tagName.toLowerCase())||t.tagName.toLowerCase()==="input"&&t.type!=="hidden"||t.role==="button",text_input_types=["text","password","email","search","url","tel","number"],isTextInsertable=t=>t.tagName.toLowerCase()==="textarea"||t.tagName.toLowerCase()==="input"&&text_input_types.includes(t.type),emptyTagWhitelist=["input","textarea","select","button"],isEmpty=t=>{const i=t.tagName.toLowerCase();if(emptyTagWhitelist.includes(i)||t.childElementCount>0)return!1;if("innerText"in t&&t.innerText.trim().length===0){const o=t.querySelector("svg"),n=t.querySelector("img");return o||n?!1:isElementInViewport(t)}return!1};function isElementInViewport(t){const i=t.getBoundingClientRect();return i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)}function getElementXPath(t){let i=[],o="";for(t&&t.ownerDocument!==window.document&&(o=`iframe[${t.getAttribute("iframe_index")}]`);t;){if(!t.tagName){t=t.parentNode;continue}let n=t.tagName.toLowerCase(),r=1,e=t.previousElementSibling;for(;e;)e.tagName===t.tagName&&r++,e=e.previousElementSibling;let s=t.nextElementSibling,a=!1;for(;s;){if(s.tagName===t.tagName){a=!0;break}s=s.nextElementSibling}if((r>1||a)&&(n+=`[${r}]`),t.id)return n+=`[@id="${t.id}"]`,i.unshift(n),"//"+i.join("/");if(t.className){const l=Array.from(t.classList);n+=`[@class="${t.className}"]`}i.unshift(n),t=t.parentNode}return o+"//"+i.join("/")}function create_tagged_span(t,i){let o;isInteractable(i)?isTextInsertable(i)?o=`[#${t}]`:i.tagName.toLowerCase()=="a"?o=`[@${t}]`:o=`[$${t}]`:o=`[${t}]`;let n=document.createElement("span");return n.id=tarsierId,n.style.position="relative",n.style.display="inline",n.style.color="white",n.style.backgroundColor="red",n.style.padding="1.5px",n.style.borderRadius="3px",n.style.fontWeight="bold",n.style.fontSize="15px",n.style.fontFamily="Arial",n.style.margin="1px",n.style.lineHeight="1.25",n.style.letterSpacing="2px",n.style.zIndex="2140000046",n.style.clip="auto",n.style.height="fit-content",n.style.width="fit-content",n.style.minHeight="fit-content",n.style.minWidth="fit-content",n.style.maxHeight="unset",n.style.maxWidth="unset",n.textContent=o,n.style.webkitTextFillColor="white",n.style.textShadow="",n.style.textDecoration="none",n}window.tagifyWebpage=(t=!1)=>{window.removeTags();let i=0,o={},n=[...document.body.querySelectorAll("*")];const r=document.getElementsByTagName("iframe");for(let e=0;e<r.length;e++)try{const s=r[e];console.log("iframe!",r[e]);const l=[...(s.contentDocument||s.contentWindow?.document).querySelectorAll("*")];l.forEach(c=>c.setAttribute("iframe_index",e)),n.push(...l)}catch(s){console.error("Cross-origin iframe:",s)}n.map(e=>{isInteractable(e)&&e.querySelectorAll("*").forEach(s=>{const a=n.indexOf(s);a>-1&&n.splice(a,1)})});for(let e of n)if(!(isEmpty(e)||!elIsClean(e))){if(isInteractable(e))o[i]=getElementXPath(e),i++;else if(t)for(let s of Array.from(e.childNodes))s.nodeType===Node.TEXT_NODE&&/\S/.test(s.textContent||"")&&(o[i]=getElementXPath(e),i++)}i=0;for(let e of n){if(isEmpty(e)||!elIsClean(e))continue;let s=create_tagged_span(i,e);if(isInteractable(e))isTextInsertable(e)&&e.parentElement?e.parentElement.insertBefore(s,e):e.prepend(s),i++;else if(t){for(let a of Array.from(e.childNodes))if(a.nodeType===Node.TEXT_NODE&&/\S/.test(a.textContent||"")){let l=create_tagged_span(i,e);e.insertBefore(l,a),i++}}}return absolutelyPositionMissingTags(),removeCollidingTags(),o};function absolutelyPositionMissingTags(){document.querySelectorAll(tarsierSelector).forEach(o=>{const n=o.parentElement,r=n.getBoundingClientRect(),e=o.getBoundingClientRect(),s={x:(r.left+r.right)/2,y:(r.top+r.bottom)/2},a={x:(e.left+e.right)/2,y:(e.top+e.bottom)/2},l=Math.abs(s.x-a.x),c=Math.abs(s.y-a.y);if(l>500||c>500||!elIsClean(o)){o.style.position="absolute";let d=Math.max(0,r.left-(e.right+3-e.left));d=Math.min(d,window.innerWidth-(e.right-e.left));let f=Math.max(0,r.top+3);f=Math.min(f,Math.max(window.innerHeight,document.documentElement.scrollHeight)-(e.bottom-e.top)),o.style.left=`${d}px`,o.style.top=`${f}px`,n.removeChild(o),document.body.appendChild(o)}})}function removeCollidingTags(){const t=Array.from(document.querySelectorAll(tarsierSelector)),i=new Set;t.forEach((o,n)=>{if(i.has(o))return;const r=o.getBoundingClientRect();for(let e=0;e<t.length;e++){if(e===n||i.has(t[e]))continue;const a=t[e].getBoundingClientRect();if(!(a.right<r.left||a.left>r.right||a.bottom<r.top||a.top>r.bottom)){i.add(o);break}}}),i.forEach(o=>o.remove())}window.removeTags=()=>{document.querySelectorAll(tarsierSelector).forEach(i=>i.remove())};
